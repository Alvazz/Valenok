# Valenok. Низкоуровневые технические требования.

## Состав и компоновка контроллера

Электрическая часть контроллера конструктивно состоит из трех основных плат:
 
 * Силовая плата.
 * Плата управления.
 * Плата звена постоянного тока. 
 
На плату управления может дополнительно устанавливаться плата расширения с разъемами. 

## Силовая плата

Силовая плата представляет из себя одностороннюю плату на алюминиевом основани.
Количество слоев меди - 1 или 2.
Толщина медного покрытия каждого слоя - не менее 100 мкм. 

Инвертор собирается на транзисторах [BSC077N12NS3GATMA1](https://www.digikey.com/en/products/detail/infineon-technologies/BSC077N12NS3GATMA1/2337847).
Транзисторы включаются параллельно по 3 шт. В цепи затвора каждого транзистора должен быть включен резистор. Номинал резистора рассчитывается исходя из емкости затвора и
максимального тока драйвера. На плате также должен устанавливаться резистор затворов параллельно включенных транзисторов. На первой итерации он будет заменен перемычкой.
Рядом с каждым транзисторным полумостом на плате устанавливается драйвер. 
Требования к полумостовому драйверу:
 
 * Максимальный ток - не менее 3 А, лучше 4 А.
 * Максимальное напряжение полумоста - не менее 120 В.
 * Раздельное независимое управление верхним и нижним транзисторами. 
 * Встроенная UVLO защита. 
 * Встроенная защита от сквозного тока.

Например, драйвер [UCC27282](https://www.ti.com/lit/ds/snvsaq5a/snvsaq5a.pdf?ts=1602424164509).

## Плата управления

### Микроконтроллер
Плата управления собирается на базе микроконтроллера [ST32F105CT7](https://www.st.com/en/microcontrollers-microprocessors/stm32f105-107.html).
Схема подключения микроконтроллера должна быть совместима с прошивкой [Sapog] (https://github.com/px4/sapog). 

`HW_ID` код для Valenok ESC `0x03`.

### Интерфейсы

На плате управления должны быть выведены следующие интерфейсы
1. **RS-232**. Интерфейс для отладки и конфигурирования контроллера с помощью CLI. Наружу выводятся только 3 сигнала: RX, TX и GND.
2. **SWD**. Интерфейс для прошивки на производстве. Используются 2 линии: SWCLK и SWDIO, - которые выводятся на TP, с обратной стороны платы.
3. **RCPWM**. Интерфейс для формирования сигнала задания с помощью ШИМ сигнала напряжением 5V. Наружу выводится только один сигнал и GND.
4. **ISO 11898-2 CAN 2.0B**. Подключение к шине CAN производится с помощью двух распараллеленных разъемов JST SM04B-GHS в соответствии с DS015 UAVCAN 
Drone Standard. 
Распиновка разъемов представлена ниже
| Pin no. | Type        | Function         | Comment         | 
| ------- |-------------| ---------------- | --------------- |
|    1    | Power       | Bus power supply | +5 V            |
|    2    |Input/output |    CAN high      |                 |
|    3    |Input/output |    CAN low       |                 |
|	   4    | Ground      |     Ground       |                 |

5. **PTC термистор**. К плате может быть подключен PTC термистор типа [KTY-84/130](https://www.nxp.com/docs/en/data-sheet/KTY84_SER.pdf?).
На плате управления размещается подтягивающий к питанию 3.3 В резистор 1.2K 1%. Термистор подключается между AGND и выводом подтяигивающего резистора.
Напряжение с термистора заводится на один из каналов АЦП микроконтроллера.
6. **Внешний RGB светодиод**. К плате может быть подключена линейка из 1..3 интеллектуальных светодиодов. Общая величина потребляемого тока светодиодов
не превышает 200 мА. Информация в светодиод передается по одной линии передачи данных DOUT, наподобие шины I2C. Наружу выводятся 3 линии: +5V, DOUT, GND.

### Шина питания

В контроллере должна быть реализована схема питания, представленная на рис. 1:
